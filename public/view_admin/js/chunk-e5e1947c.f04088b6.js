(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-e5e1947c"],{4348:function(t,e,i){"use strict";var a=i("d3bc");i.n(a).a},8084:function(t,e,i){"use strict";i.r(e);var a=i("a34a"),s=i.n(a),n=i("12e0"),r=i("d708"),o=i("c276");function c(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function l(t,e,i,a,s,n,r){try{var o=t[n](r),c=o.value}catch(t){return void i(t)}o.done?e(c):Promise.resolve(c).then(a,s)}function u(t){return function(){var e=this,i=arguments;return new Promise((function(a,s){var n=t.apply(e,i);function r(t){l(n,a,s,r,o,"next",t)}function o(t){l(n,a,s,r,o,"throw",t)}r(void 0)}))}}var d={name:"uploadPictures",components:{uploadVideo:i("7774").a},props:{isChoice:{type:String,default:""},gridBtn:{type:Object,default:null},gridPic:{type:Object,default:null},isShow:{type:Number,default:1}},data:function(){return{searchClass:!1,spinShow:!1,fileUrl:r.a.apiBaseURL+"/file/upload",modalPic:!1,treeData:[],treeData2:[],pictrueList:[],uploadData:{},checkPicList:[],uploadName:{name:"",file_type:"1"},FromData:null,treeId:0,isJudge:!1,buttonProps:{type:"default",size:"small"},fileData:{pid:0,page:1,limit:40},total:0,pids:0,list:[],modalTitleSs:"",isShowPic:!1,header:{},ids:[],headTab:[{title:"图片",name:"1"},{title:"视频",name:"2"}],modalVideo:!1}},mounted:function(){var t=this;this.getToken(),this.getList(),this.getFileList(),document.addEventListener("click",(function(e){e.target.classList.contains("nameStyle")||e.target.classList.contains("preview")||e.target.classList.contains("ivu-icon-ios-eye")||e.target.parentNode.classList.contains("nameStyle")||(t.player&&(t.player.dispose(),t.player=null),t.pictrueList.forEach((function(t){t.realName=!1})))}),!0)},methods:{createPoster:function(t){new Promise((function(e,i){var a=document.createElement("video");a.setAttribute("src",t.att_dir),a.setAttribute("crossOrigin","anonymous"),a.setAttribute("width",100),a.setAttribute("height",100),a.setAttribute("preload","auto"),a.addEventListener("canplay",(function(){var t=document.createElement("canvas"),i=t.getContext("2d"),s=a.width,n=a.height;t.width=s,t.height=n,i.drawImage(a,0,0,s,n),e(t.toDataURL("image/jpeg"))}))})).then((function(e){t.poster=e}))},preview:function(t){this.pictrueList.forEach((function(e){t.att_id==e.att_id?e.realName=!e.realName:e.realName=!1})),2==t.file_type&&this.createPlayer(t)},createPlayer:function(t){this.player&&(this.player.dispose(),this.player=null),this.player=new Aliplayer({id:"player".concat(t.att_id),width:"100%",height:"100%",autoplay:!0,source:t.att_dir})},uploadVideo:function(){this.modalVideo=!0},getvideo:function(){this.modalVideo=!1,this.fileData.page=1,this.getFileList()},onhangeTab:function(){this.getList(),this.getFileList(),this.checkPicList=[]},enterMouse:function(t){t.realName=!t.realName},enterLeave:function(t){t.isShowEdit=!t.isShowEdit},getToken:function(){this.header["Authori-zation"]="Bearer "+o.a.cookies.get("token")},renderContent:function(t,e){var i=this,a=e.root,s=e.node,n=e.data,r=[];return 0==n.pid&&r.push(t("div",{class:["ivu-dropdown-item"],on:{click:function(){i.append(a,s,n)}}},"添加分类")),n.id&&r.push(t("div",{class:["ivu-dropdown-item"],on:{click:function(){i.editPic(a,s,n)}}},"编辑分类"),t("div",{class:["ivu-dropdown-item"],on:{click:function(){i.remove(a,s,n,"分类")}}},"删除分类")),t("span",{class:["ivu-span"],style:{display:"inline-block",width:"88%",height:"32px",lineHeight:"32px",position:"relative",color:"rgba(0,0,0,0.6)",cursor:"pointer"},on:{mouseenter:function(){i.onMouseOver(a,s,n)},mouseleave:function(){i.onMouseOver(a,s,n)}}},[t("span",{on:{click:function(t){i.appendBtn(a,s,n,t)}}},n.title),t("div",{style:{display:"inline-block",float:"right"}},[t("Icon",{props:{type:"ios-more"},style:{marginRight:"8px",fontSize:"20px",display:n.flag?"inline":"none"},on:{click:function(){i.onClick(a,s,n)}}}),t("div",{class:["right-menu ivu-poptip-inner"],style:{width:"80px",position:"absolute",zIndex:"9",top:"32px",right:"12px",display:n.flag2?"block":"none"}},r)])])},renderContentSel:function(t,e){var i=this,a=e.root,s=e.node,n=e.data;return t("div",{style:{display:"inline-block",width:"90%"}},[t("span",[t("span",{style:{cursor:"pointer"},class:["ivu-tree-title"],on:{click:function(t){i.handleCheckChange(a,s,n,t)}}},n.title)])])},handleCheckChange:function(t,e,i,a){this.list=[];var s=i.id,n=i.title;this.list.push({value:s,title:n}),this.ids.length?(this.pids=s,this.getMove()):this.$Message.warning("请先选择图片");for(var r=this.$refs.reference.$el.querySelectorAll(".ivu-tree-title-selected"),o=0;o<r.length;o++)r[o].className="ivu-tree-title";a.path[0].className="ivu-tree-title  ivu-tree-title-selected"},getMove:function(){var t=this,e={pid:this.pids,images:this.ids.toString()};Object(n.f)(e).then(function(){var e=u(s.a.mark((function e(i){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.$Message.success(i.msg),t.getFileList(),t.pids=0,t.checkPicList=[],t.ids=[];case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){t.$Message.error(e.msg)}))},editPicList:function(t){var e=this,i={ids:this.ids.toString()};"number"==typeof t&&(i={ids:t.toString()});var a={title:1==this.uploadName.file_type?"删除选中图片":"删除选中视频",url:"file/file/delete",method:"POST",ids:i};this.$modalSure(a).then((function(t){e.$Message.success(t.msg),e.getFileList(),e.checkPicList=[]})).catch((function(t){e.$Message.error(t.msg)}))},onMouseOver:function(t,e,i){event.preventDefault(),i.flag=!i.flag,i.flag2&&(i.flag2=!1)},onClick:function(t,e,i){i.flag2=!i.flag2},appendBtn:function(t,e,i,a){this.treeId=i.id?i.id:0,this.fileData.page=1,this.getFileList();for(var s=this.$refs.tree.$el.querySelectorAll(".ivu-tree-title-selected"),n=0;n<s.length;n++)s[n].className="ivu-tree-title";a.path[0].className="ivu-tree-title  ivu-tree-title-selected"},append:function(t,e,i){this.treeId=i.id,this.getFrom()},remove:function(t,e,i,a){var s=this;this.tits=a;var n={title:"删除 [ "+i.title+" ] 分类",url:"file/category/".concat(i.id),method:"DELETE",ids:""};this.$modalSure(n).then((function(t){s.$Message.success(t.msg),s.getList(),s.checkPicList=[]})).catch((function(t){s.$Message.error(t.msg)}))},editPic:function(t,e,i){var a=this;this.$modalForm(Object(n.a)(i.id,{file_type:this.uploadName.file_type})).then((function(){return a.getList()}))},changePage:function(){this.getList("search")},getList:function(t){var e=this,i={title:1==this.uploadName.file_type?"全部图片":"全部视频",id:"",pid:0};Object(n.e)(this.uploadName).then(function(){var a=u(s.a.mark((function a(n){return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:e.treeData=n.data.list,e.treeData.unshift(i),"search"!==t?e.treeData2=c(e.treeData):e.searchClass=!0,e.addFlag(e.treeData);case 4:case"end":return a.stop()}}),a)})));return function(t){return a.apply(this,arguments)}}()).catch((function(t){e.$Message.error(t.msg)}))},loadData:function(t,e){Object(n.e)({pid:t.id,file_type:this.uploadName.file_type}).then(function(){var t=u(s.a.mark((function t(i){var a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=i.data.list,e(a);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(t){}))},addFlag:function(t){var e=this;t.map((function(t){e.$set(t,"flag",!1),e.$set(t,"flag2",!1),t.children&&e.addFlag(t.children)}))},add:function(){this.treeId=0,this.getFrom()},getFileList:function(){var t=this;this.fileData.pid=this.treeId,this.fileData.file_type=this.uploadName.file_type,Object(n.c)(this.fileData).then(function(){var e=u(s.a.mark((function e(i){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i.data.list.forEach((function(e){e.isSelect=!1,e.isEdit=!1,e.isShowEdit=!1,e.realName=!1,e.num=0,t.editName(e),2==e.file_type&&(e.poster="",e.satt_dir.includes("uploads")&&t.createPoster(e))})),t.pictrueList=i.data.list,t.pictrueList.length?t.isShowPic=!1:t.isShowPic=!0,t.total=i.data.count;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){t.$Message.error(e.msg)}))},pageChange:function(t){this.fileData.page=t,this.getFileList(),this.checkPicList=[]},getFrom:function(){var t=this;this.$modalForm(Object(n.b)({id:this.treeId,file_type:this.uploadName.file_type})).then((function(e){t.getList()}))},beforeUpload:function(t){var e=this;if(-1===["image/png","image/jpg","image/jpeg","image/gif"].indexOf(t.type))return this.$Message.warning({content:"文件  "+t.name+"  格式不正确, 请选择格式正确的图片",duration:5}),!1;var i=this.$cache.local.getJSON("file_size_max"),a=i/1024/1024;return t.size<i?(this.uploadData={pid:this.treeId},new Promise((function(t){e.$nextTick((function(){t(!0)}))}))):(this.$Message.warning({content:"文件体积过大,图片大小不能超过"+a+"M",duration:5}),!1)},handleSuccess:function(t,e,i){200===t.status?(this.fileData.page=1,this.$Message.success(t.msg),this.getFileList()):this.$Message.error(t.msg)},cancel:function(){this.$emit("changeCancel")},changImage:function(t,e,i){var a=this,s=0;t.isSelect?(t.isSelect=!1,this.checkPicList.map((function(e,i){e.att_id==t.att_id&&(s=i)})),this.checkPicList.splice(s,1)):(t.isSelect=!0,this.checkPicList.push(t)),this.ids=[],this.checkPicList.map((function(t,e){a.ids.push(t.att_id)})),this.pictrueList.map((function(t,e){t.isSelect?a.checkPicList.filter((function(e,i){t.att_id==e.att_id&&(t.num=i+1)})):t.num=0}))},checkPics:function(){if("单选"===this.isChoice){if(this.checkPicList.length>1)return this.$Message.warning("最多只能选一张图片");this.$emit("getPic",this.checkPicList[0])}else{var t=this.$route.query.maxLength;if(void 0!=t&&this.checkPicList.length>Number(t))return this.$Message.warning("最多只能选"+t+"张图片");this.$emit("getPicD",this.checkPicList)}},editName:function(t){var e=t.real_name.split("."),i=void 0==e[1]?[]:e[1];e[0].length,i.length,t.editName=t.real_name},bindTxt:function(t){var e=this;""==t.real_name&&this.$Message.error("请填写内容"),Object(n.d)(t.att_id,{real_name:t.real_name}).then((function(i){e.editName(t),t.isEdit=!1,e.$Message.success(i.msg)})).catch((function(t){e.$Message.error(t.msg)}))}}},h=(i("4348"),i("2877")),p=Object(h.a)(d,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"Modal"},[i("Row",[i("Col",{attrs:{span:"24"}},[i("Tabs",{on:{"on-click":t.onhangeTab},model:{value:t.uploadName.file_type,callback:function(e){t.$set(t.uploadName,"file_type",e)},expression:"uploadName.file_type"}},t._l(t.headTab,(function(t,e){return i("TabPane",{key:e,attrs:{label:t.title,name:t.name}})})),1)],1)],1),i("Row",[i("Col",{attrs:{span:"4"}},[i("div",{staticClass:"input"},[i("Input",{staticStyle:{width:"90%"},attrs:{search:"",placeholder:"请输入分类名称"},on:{"on-search":t.changePage},model:{value:t.uploadName.name,callback:function(e){t.$set(t.uploadName,"name",e)},expression:"uploadName.name"}})],1)]),i("Col",{attrs:{span:"20"}},[1==t.uploadName.file_type?i("Upload",{staticClass:"mr10",staticStyle:{"margin-top":"1px",display:"inline-block"},attrs:{"show-upload-list":!1,action:t.fileUrl,"before-upload":t.beforeUpload,data:t.uploadData,headers:t.header,multiple:!0,"on-success":t.handleSuccess}},[i("Button",[t._v("上传图片")])],1):i("Button",{staticClass:"mr10",on:{click:t.uploadVideo}},[t._v("上传视频")]),i("Button",{staticClass:"mr10",attrs:{disabled:0===t.checkPicList.length},on:{click:function(e){return e.stopPropagation(),t.editPicList("图片")}}},[t._v(t._s(1==t.uploadName.file_type?"删除图片":"删除视频"))]),i("i-select",{staticClass:"treeSel input-add",attrs:{value:t.pids,placeholder:1==t.uploadName.file_type?"图片移动至":"视频移动至"}},[t._l(t.list,(function(e,a){return i("i-option",{key:a,staticClass:"display-add",attrs:{value:e.value}},[t._v("\n            "+t._s(e.title)+"\n          ")])})),i("Tree",{ref:"reference",staticClass:"selectTree",attrs:{data:t.treeData2,render:t.renderContentSel,"load-data":t.loadData}})],2)],1)],1),i("Row",{staticClass:"colLeft"},[i("Col",{staticClass:"colLeft left",attrs:{span:"4"}},[i("div",{staticClass:"Nav"},[i("div",{staticClass:"trees-coadd"},[i("div",{staticClass:"scollhide"},[i("div",{staticClass:"trees"},[i("Tree",{ref:"tree",staticClass:"treeBox",attrs:{data:t.treeData,render:t.renderContent,"load-data":t.loadData}}),t.searchClass&&t.treeData.length<=1?i("div",{staticClass:"searchNo"},[t._v("\n                  此分类暂无数据\n                ")]):t._e()],1)])])])]),i("Col",{staticClass:"colLeft right",attrs:{span:"20"}},[i("div",{staticClass:"conter"},[i("div",{staticClass:"pictrueList acea-row"},[i("Row",{staticClass:"conter",attrs:{gutter:24}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowPic,expression:"isShowPic"}],staticClass:"imagesNo"},[i("Icon",{attrs:{type:"ios-images",size:"60",color:"#dbdbdb"}}),i("span",{staticClass:"imagesNo_sp"},[t._v(t._s(1==t.uploadName.file_type?"图片库为空":"视频库为空"))])],1),i("div",{staticClass:"acea-row"},t._l(t.pictrueList,(function(e,a){return i("div",{key:a,staticClass:"pictrueList_pic",on:{mouseenter:function(i){return t.enterLeave(e)},mouseleave:function(i){return t.enterLeave(e)}}},[e.num>0?i("p",{staticClass:"number"},[i("Badge",{attrs:{count:e.num,type:"error",offset:[11,12]}},[i("a",{staticClass:"demo-badge",attrs:{href:"#"}})])],1):t._e(),i("div",{staticClass:"picimage"},[i("img",{directives:[{name:"lazy",rawName:"v-lazy",value:e.poster||e.satt_dir,expression:"item.poster || item.satt_dir"}],class:e.isSelect?"on":"",on:{click:function(i){return i.stopPropagation(),t.changImage(e,a,t.pictrueList)}}})]),i("div",{staticClass:"picName"},[e.isEdit?i("Input",{attrs:{size:"small",type:"text"},on:{"on-blur":function(i){return t.bindTxt(e)}},model:{value:e.real_name,callback:function(i){t.$set(e,"real_name",i)},expression:"item.real_name"}}):i("p",{attrs:{title:e.editName}},[t._v("\n                      "+t._s(e.editName)+"\n                    ")]),i("div",{staticClass:"picMenu"},[i("ButtonGroup",[i("Button",{attrs:{size:"small"},on:{click:function(t){e.isEdit=!e.isEdit}}},[i("Icon",{attrs:{type:"ios-create"}})],1),i("Button",{staticClass:"preview",attrs:{size:"small"},on:{click:function(i){return t.preview(e)}}},[i("Icon",{attrs:{type:"ios-eye"}})],1),i("Button",{attrs:{size:"small"},on:{click:function(i){return t.editPicList(e.att_id)}}},[i("Icon",{attrs:{type:"ios-trash"}})],1)],1)],1)],1),i("div",{directives:[{name:"show",rawName:"v-show",value:e.realName&&e.real_name,expression:"item.realName && item.real_name"}],staticClass:"nameStyle"},[1==e.file_type?i("img",{attrs:{src:e.satt_dir}}):2==e.file_type?i("div",{attrs:{id:"player"+e.att_id}}):t._e()])])})),0)])],1),i("div",{staticClass:"footer acea-row row-right"},[i("Page",{attrs:{total:t.total,"show-elevator":"","show-total":"",current:t.fileData.page,"page-size":t.fileData.limit},on:{"on-change":t.pageChange}})],1)])])],1),i("Modal",{attrs:{width:"1024px",scrollable:"","footer-hide":"",closable:"",title:"上传视频","mask-closable":!1,"z-index":9},model:{value:t.modalVideo,callback:function(e){t.modalVideo=e},expression:"modalVideo"}},[i("uploadVideo",{attrs:{pid:t.fileData.pid},on:{getVideo:t.getvideo}})],1)],1)}),[],!1,null,"3c3b02bb",null);e.default=p.exports},d3bc:function(t,e,i){}}]);